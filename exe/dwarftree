#!/usr/bin/env ruby

require 'dwarftree'
require 'optparse'
require 'set'

subprograms = Set.new
dies = Set.new

objects = OptionParser.new do |o|
  o.banner = "Usage: #{$0} OBJECT"
  o.on('-s', '--subprogram NAME1,NAME2,...', String, 'Show only specified subprograms') do |ss|
    ss.split(',').each { |s| subprograms.add(s) }
  end
  o.on('-d', '--die TAG1,TAG2,...', String, 'Show only specified DIEs') do |ds|
    ds.split(',').each { |d| dies.add(d) }
  end
end.parse!(ARGV)

objects.each do |object|
  Dwarftree.run(object, dies: dies, subprograms: subprograms)
end
